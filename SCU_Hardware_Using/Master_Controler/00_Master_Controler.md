# Master_Controler_V4.1.1

v4.1.1

基于前代主控的更新，本人能力有限，仅仅主控更新就迭代了若干个小版本，主要对can芯片选型以及部分保护电路的更新，大多参考（）大疆`RoboMaster `开发板，基本实现本赛季初本人设计的目标，在可预见的下半赛季不会进行原理图的更改，故作此记录，希望后来人能在此基础上做出优化，不断更新。 

## 文档说明

### 更新说明

基于入队考核题对主控进行更新并在入队后进行不断迭代改进后的产品

### 器件选型

**主控**：stm32g474vet6，19年推出的新系列，主打性能更强，而且🔋科用的也是这一款

**降压电路**：

	1. TPS5430降压芯片： 便宜、简单、好用、多用
 	2. AMS1117/TLV1117：参考[【2毛钱的线性稳压器(LDO)你也敢用？】](https://www.bilibili.com/video/BV1464y1v7Jd?vd_source=c34265eabafe1cdd353228c94e5b1881)视频觉得AMS太垃圾于是选用TLV，但在实际使用过程中两者貌似没有太大差别，选用TLV目前来看只是徒增成本，所以后来可以考虑选择更好的1117
 	3. MAX3051： RM硬件群中推荐的CAN收发器，当初在设计时参考芯片手册觉得比原来TJA1051会好一些，但是实际上和LDO的选型出现了一样的问题，用起来貌似只是徒增成本，不过MAX3051的故障率确实会比TJA要好些

### 原理图设计

**电源输入保护电路**：仿照大疆RoboMasterC板的电源输入电路进行防反接、防过压、缓启动电路设计

![](https://gegeekblog-1325046062.cos.ap-chengdu.myqcloud.com/blog20240331150642.png)

电路原理参考视频[【RoboMaster 机甲大师赛开发板防反接，上电缓启动，过压保护电路分析RoboMaster发板A型电路分析 B型电路分析C 型电路分析主控开发板电路分析】]( https://www.bilibili.com/video/BV1e24y147Px/?share_source=copy_web&vd_source=c34265eabafe1cdd353228c94e5b1881)

基本原理可以简单如下解释：

	1. DR11为TVS可以防止尖峰电压，可以不接
 	2. R22和C31、R23和C32为RC滤波
 	3. R7、D1和Q3组成防反接电路，只有当电路正向接通电源时，D1正向稳压使得Q3导通
 	4. 其他部分组成缓启动以及防过压设计，只有D2稳压电压值和VBUS电压值相同时Q2关断，此时VGS=-VBUS，导通Q1 ，整个电路导通!

**串口保护电路**：

![](https://gegeekblog-1325046062.cos.ap-chengdu.myqcloud.com/blog20240331151619.png)

1. 磁珠滤去尖峰电压带来的能量并滤波
2. 电容率波
3. TVS也是滤去多余电压

### LayOut设计

1. 在布局上选择将所有元器件放置在顶面，由于电路并不复杂，这样可以更方便进行贴片焊接
2. 对串口等线序进行更改，主要将串口原来的VTRG改为VGTR减小直接反接带来的损害
3. 晶振包地设计
4. 虽然单片机供电电压为ma级别大小，但是仍然想建立良好的布局布线意识，参考[DCDC开关电源PCB设计实战（16)BUCK电路PCB设计（16）TI杯电赛和NXP智能车电源设计第16讲_哔哩哔哩_bilibili](https://www.bilibili.com/video/av70822493/?from=search&seid=6832888621467548192&vd_source=58fb616e515e18407441595ac2bcf077)等一系列视频进行学习总结，详见：（连接后附）



